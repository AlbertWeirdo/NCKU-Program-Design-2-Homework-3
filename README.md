
# PD2 Homework 3

![Generated by DALL.E](https://prod-files-secure.s3.us-west-2.amazonaws.com/8018ca60-cf99-48b4-a62e-55e2ca1a20e0/e217e6d4-83a9-4565-bfda-9479be6cdf0a/Untitled.png)

Generated by DALL.E

<aside>
🔥 Announcement:

- Deadline - 2024/4/19 23:59
- Server作業繳交Guideline 請見:
[作業繳交Guideline](https://www.notion.so/Guideline-479ba499d8374b4b990f844ab4eb9e95?pvs=21)
</aside>

<aside>
🔥

</aside>

# Powerful Toolkit in Java: Using HTML Parser to Crawl Internet Data

## 前言

Java是一種應用服務支援度極強大的程式語言，尤其在Internet上層處理相關套件非常齊全。例如，Java的jsoup套件就能提供我們強大的網路爬蟲工具。利用Java的這些套件，我們可以輕鬆地實現各種多元的應用。本次Homework即讓同學練習怎麼簡單利用3rd party library實作多元的應用。

Java is a programming language with a strong support for application services, especially with its complete set of packages for application layer of Internet processing. For example, Java's jsoup package can provide us with powerful web crawling tools. With these Java packages, we can easily implement various applications. This homework lets students practice how to simply use a 3rd party library to implement diverse applications.

## Homework Requirement

使用 jsoup 爬[指定網站](https://pd2-hw3.netdb.csie.ncku.edu.tw/)上的股價資料。你抓到的是個html檔案，但其主要的內容如：

Use jsoup to crawl the stock price data on the [specified website](https://pd2-hw3.netdb.csie.ncku.edu.tw/). What you catch is an html file, but its main content is:

```java
AAL	AAPL	ABT	ACN	ADBE	ADI	ADP	ADSK	AIG	AKAM	ALL	ALXN	AMGN	AMZN	ATVI	AXP	BAC	BA	BBBY	BIDU	BIIB	BKNG	BK	BLK	BMRN	BMY	BRK-B	CERN	CHKP	CL	CMCSA	COF	COP	COST	CSCO	CSX	CTSH	CTXS	CVS	CVX	C	DHR	DISCA	DISH	DIS	DLTR	DUK	EA	EBAY	EMR	EXC	EXPE	FAST	FDX	FISV	F	GE	GILD	GOOGL	GS	HD	HON	HSIC	IBM	ILMN	INCY	INTC	INTU	ISRG	JNJ	JPM	KO	LBTYA	LLY	LOW	LRCX	MAR	MAT	MCD	MCHP	MDLZ	MDT	MET	MMM	MNST	MO	MRK	MSFT	MU	MXIM	MYL	NEE	NFLX	NKE	NTAP	NTES	NVDA	ORCL	ORLY	OXY	PAYX	PCAR	PFE	PG	QCOM	REGN	ROST	SBUX	SIRI	SLB	SO	SPG	SRCL	STX	SWKS	TG...
20.70	1.72	11.26	19.62	31.21	24.01	23.25	45.59	891.76	17.25	36.89	6.59	58.89	45.95	7.12	37.15	30.91	46.44	33.80	7.00	39.09	20.32	23.27	62.51	7.87	12.25	55.78	10.55	21.25	15.27	7.12	58.88	25.38	35.18	12.84	5.46	10.79	20.48	20.47	32.52	391.99	11.98	7.19	19.92	18.65	7.29	26.83	54.77	16.11	21.25	28.33	25.79	6.16	79.17	10.61	5.55	19.63	9.71	170.12	97.94	27.24	22.01	16.13	55.02	7.00	4.81	15.06	20.59	23.24	41.42	23.61	10.90	12.83	29.64	23.93	31.00	24.24	8.93	20.53	18.29	12.58	41.47	28.99	50.20	1.97	7.57	15.08	1...
```

第一排是股票的名稱，第二排是當下時間的股價。

The first row is the name of the stock, the second row is the current stock price.

你的程式需達成以下要求：

- task0：以append的形式，將當下時間點所抓到的股票資料，存到`output.csv`

task0: Using “append” mode, store the stock data captured at the current time point into `output.csv`.

格式（由時間先後排序）

```
股票代號
第1天的股價
第2天的股價
...(以此類推)
```

範例

```bash
$ cat output.csv
AAL,AAPL,ABT,...
1.11,2.11,3.11,...
1.22,2.22,3.22,...
...
```

- task1：輸出指定股票在指定時間段的股價 5 日移動平均至`output.csv`

task1: Output the 5-day moving average of the specified stock price during the specified time period to `output.csv`

     公式

簡單移動平均（Simple Moving Average）的計算公式為：

1. 將一定時間窗口內的所有價格加總
2. 然後，除以時間窗口的長度
3. 最後，得出的結果就是這個時間窗口的簡單移動平均值。

$$
\bar{p}_{SMA} = \frac{1}{n}(p_M+p_{M-1}+...+p_{M-(n-1)}) =\frac{1}{n}\sum_{i=0}^{n-1} p_{M-i}
$$

其中：

- \(\bar{p}_{SMA}\) 是第 \(M\) 天的簡單移動平均值
- \(p_M\) 是第 \(M\) 天的股價
- \(\sum_{i=0}^{n-1} p_{M-i}\) 是在第 \(M\) 天以前的一定時間窗口內的股價總和
- \(n\) 是時間窗口的長度

     格式（由時間先後排序）

```
股票代號,起始時間,結束時間
第1~5天的平均,第2~6天的平均...(以此類推)
```

     範例

```bash
$ cat output.csv
AAL,1,30
1.11,2.22,3.33...
```

- task2：輸出指定股票在指定時間段的股價標準差至`output.csv`

task2: Output the standard deviation of the specified stock price during the specified time period to `output.csv`

公式

樣本標準差的計算公式如下：

1. 首先，計算所有數據點與樣本平均值的差異。
2. 然後，將每個差異的平方值加總，得到差方和（sum of squared deviations）。
3. 接著，將差方和除以數據點的數量減一，得到樣本變異數。
4. 最後，取樣本變異數的平方根，得到樣本標準差。

以數學公式表示為：

$$
s = \sqrt{\frac{1}{n-1}\sum_{i=1}^{n} (x_i -\bar{x})^2}
$$

其中：

- \(s\) 是樣本標準差
- \(\sum\) 表示所有數據點的總和
- \(x_i\) 是每一個數據點
- \(\bar{x}\) 是數據點的樣本平均值
- \(n\) 是數據點的數量
- \(\sqrt{}\) 表示取平方根

格式

```
股票代號,起始時間,結束時間
標準差
```

範例

```bash
$ cat output.csv
AAL,1,30
1.11
```


- task3：輸出指定時間段的股價標準差大的 top-3 至 `output.csv`

task3: Output the top-3 stocks with the highest standard deviation in a specified time period to `output.csv`.

格式（由大到小排序）

```
股票代號1,股票代號2,股票代號3,起始時間,結束時間
標準差1,標準差2,標準差3
```

範例

```bash
$ cat output.csv
AAL,AAPL,ABT,1,30
100.11,99.22,98.33
```

- task4：輸出指定股票在指定時間段的回歸直線至`output.csv`

task4: Output the regression line of the specified stock during the specified time period to `output.csv`.

公式

回歸直線的方程式為：

$$
T_t = b_0 + b_1 t
$$

其中：

- \(T_t\) 是時間點 \(t\) 的線性回歸預測值（股價）
- \(t\) 是時間點 \(t\)
- \(b_0\) 是回歸直線的截距
- \(b_1\) 是回歸直線的斜率

在簡單線性迴歸中，截距（\(b_0\)）和斜率（\(b_1\)）的計算公式為：

$$
b_0 = \bar{Y} - b_1 \bar{t} \newline
b_1 = \frac{\sum_{t=1}^{n}(t-\bar{t})(Y_t-\bar{Y})}{\sum_{t=1}^{n}(t-\bar{t})^2}
$$

其中：

- \(\bar{Y}\) 是數據點的樣本平均值（股價平均）
- \(\bar{t}\) 是時間平均值
- \(Y_t\) 是第 \(t\) 天的數據點（股價）
- \(n\) 是數據點的數量

格式

```
股票代號,起始時間,結束時間
斜率,截距
```

範例

```bash
$ cat output.csv
AAL,1,30
100.11,99.22
```


## Input Arguments

```bash
$ java HtmlParser {mode} {task} {stock} {start} {end}
```

- `mode` ：以爬蟲摸式或分析模式呼叫程式。
    - 0：爬蟲模式，解析指定網站取得對應當時的股價資料 append 至 `data.csv`，並在使用 `mode=1` 時呼叫程式輸出至 `output.csv`。
    - 1：分析模式，分析蒐集至今的全部股價資料，根據 `task` 輸出對應資訊至 `output.csv` 。
- `task` ：用於分析模式的參數，表示當前需分析的資訊。
    - 0：輸出搜集至今的股價資料至 `output.csv` 。
    - 1：輸出指定股票（`stock`）在指定時間段（`start`, `end`）的股價 5 日移動平均至 `output.csv` 。
    - 2：輸出指定股票（`stock`）在指定時間段（`start`, `end`）的股價標準差至 `output.csv` 。
    - 3：輸出指定時間段（`start`, `end`）的股價標準差大的 top-3 至 `output.csv` 。
    - 4：輸出指定股票（`stock`）在指定時間段（`start`, `end`）的回歸直線至 `output.csv` 。
- `stock` ：用於分析模式的參數，表示分析的對象（股票），於 `task == 3` 時無用。
- `start`：用於分析模式的參數，表示指定時間段的開始。
- `end`：用於分析模式的參數，表示指定時間段的結束（含）。

所有呼叫方式的範例：

```bash
# 呼叫程式搜集當前時間點的股票資料
$ java HtmlParser 0

# 呼叫程式輸出搜集至今的股價資料至output.csv
$ java HtmlParser 1 0

# 呼叫程式輸出AAL的第2天到第6天(含)的股價5日移動平均至output.csv
$ java HtmlParser 1 1 AAL 2 6

# 呼叫程式輸出AAL的第1天到第3天(含)的標準差至output.csv
$ java HtmlParser 1 2 AAL 1 3

# 呼叫程式輸出第1天到第15天(含)的標準差top-3至output.csv
$ java HtmlParser 1 3 1 15

# 呼叫程式輸出AAL的第1天到第30天(含)的回歸直線至output.csv
$ java HtmlParser 1 4 AAL 1 30
```

## Homework Validation

- 測資的位置位於 `/home/share/hw3/` ，`tc0` ~ `tc4` 為測資，而 `ans0` ~ `ans4` 為答案。
- 於測資的地方也會提供 `validate_hw3.py` (`/home/share/hw3/validate_hw3.py`) 程式協助同學檢查自己程式於測試資料上執行的正確性。
- `python3 validate_hw3.py` 指令是用來運行所有的 testcase，裡面將您的 `HtmlParser.java` 加上測資得到輸出檔案(`output.csv`)後，使用 `diff` 與正確答案進行比對。
- 程式輸出的檔案名稱請命名為 `output.csv` 。

### 作業的檔案名稱請命名為 `HtmlParser.java` 。

## Tips

### 如何解析網頁：jsoup

以下是一個Java範例，示範如何下載與使用jsoup。

```java
// JsoupExample.java

import org.jsoup.Jsoup;
import org.jsoup.nodes.*;
import org.jsoup.select.*;

import java.io.IOException;

class JsoupExample {
    public static void main(String[] args) {
        try {
            Document doc = Jsoup.connect("https://en.wikipedia.org/").get();
            System.out.println(doc.title());
            Elements newsHeadlines = doc.select("#mp-itn b a");
            for (Element headline : newsHeadlines) {
                System.out.printf("%s\n\t%s", 
                headline.attr("title"), headline.absUrl("href"));
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

```bash
$ curl -o jsoup.jar https://jsoup.org/packages/jsoup-1.17.2.jar

# In Windows
$ javac -cp ".;./jsoup.jar" JsoupExample.java
$ java -cp ".;./jsoup.jar" JsoupExample

# In Linux/Mac
$ javac -cp ".:./jsoup.jar" JsoupExample.java
$ java -cp ".:./jsoup.jar" JsoupExample
```

### 如何定時呼叫程式：crontab

以下是一個`crontab`範例，示範如何使用`crontab`呼叫執行Java執行檔。

要使用 `crontab` 每兩分鐘執行 Java 的 class 檔案，你需要在 `crontab` 中設定一個任務。首先，打開 `crontab` 編輯器：

```bash
crontab -e
```

然後，添加如以下的指令：

```bash
*/2 * * * * cd /path/to/class/files/folder && /path/to/java -cp ".:/path/to/class/files" YourClassName
```

這裡，`*/2 * * * *` 代表每兩分鐘執行一次，`cd`是切換目錄的指令，`/path/to/class/files`是你的 class 檔案的目錄的路徑，`/path/to/java` 是 Java 執行檔的路徑，`YourClassName` 是您的 class 的名稱。

完成編輯後保存並退出。

## Reference

- [jsoup github](https://github.com/jhy/jsoup/)
- [移動平均 - 維基百科，自由的百科全書](https://zh.wikipedia.org/zh-tw/%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87#%E7%AE%80%E5%8D%95%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87)
- [標準差 - 維基百科，自由的百科全書](https://zh.wikipedia.org/zh-tw/%E6%A8%99%E6%BA%96%E5%B7%AE#%E6%A0%B7%E6%9C%AC%E7%9A%84%E6%A0%87%E5%87%86%E5%B7%AE)
- [Simple linear regression - Wikipedia](https://en.wikipedia.org/wiki/Simple_linear_regression)
- [鳥哥私房菜 - 第十五章、例行性工作排程(crontab)](https://linux.vbird.org/linux_basic/centos7/0430cron.php#cron)
- https://pd2-hw3.netdb.csie.ncku.edu.tw/
